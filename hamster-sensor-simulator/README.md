# Hamster Sensor Simulator

Сервис-симулятор, который генерирует события `HamsterEvent` и шлёт их в Tracker по HTTP.

## Допущения

Я полагаю, что:
- В системе имеется константное число колес, оно задается через конфиг (wheelCount: 100). 
- Число хомяков и датчиков может меняться. Датчики распределяются равномерно. Мы можем добавить хомяков/датчики через REST API. 
  - особенности:
    - Мы не пересоздаем все объекты, а лишь пытаемся применить дельту. То есть если мы стартовали со 100 хомяков и 200 датчиков, то при изменении конфига
      на 120 250 - мы добавим недостающих хомяков и датчиков.
    - При удалении работает механизм, который выпускает в первую очередь свободных хомяков и сломанные датчики
- В колесе может быть один хомяк, но много датчиков, которые транслируют одинаковые события 
  HamsterEnter/HamsterExit и WheelSpin, а также могут индивидуально прислать SensorFailure. 
- SensorFailure бывает двух типов: с кодом 500 (временный сбой) и кодом 666 (после этого датчик меняет статус на BROKEN и событие не отправляет).
- Хомяки стартуют с очереди readyHamsters и входят в колесо.
- Если внутри колеса нет хомяка, то датчики молчат. (Сломаться они тоже не могут)
- Я хотел ограничить события WheelSpin. У меня получилось, но с особенностью. В моей системе датчик понимает на старте сколько хомяк пробежит
  и отправляет это значение, допустим 15 секунд. Следующие 15 секунд колесо не будет генерировать других событий HamsterEnter/HamsterExit и WheelSpin
- Датчики не отправляют некорректные значения.

## Ограничения

- количество хомяков и датчиков от 1 до 10_000;
- не чаще 1 события/сек на датчик;

## Возможности

- конфиг через REST: количество хомяков и датчиков (1..10_000);
- сценарии:
  - `HamsterEnter/HamsterExit` — вероятность входа/выхода ~10% за минуту;
  - `WheelSpin` — длительность 1..30 сек;
  - `SensorFailure` — вероятность 1% за минуту;
- отправка в трекер `POST /events`.

## Конфиг

```yaml
server:
  port: 8081

tracker:
  base-url: http://localhost:8080

simulator:
  defaults:
    hamster-count: 400
    sensor-count: 200
  wheelCount: 100
  tickSeconds: 1
  enterPerMinute: 0.10
  failPerMinute: 0.01
  temporaryFailShare: 0.8
  spinSecMin: 1
  spinSecMax: 30
  restSecAfterEscape: 10
  parallelism: 4
  perWheelIoConcurrency: 64